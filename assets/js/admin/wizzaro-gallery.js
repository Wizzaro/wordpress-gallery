var Wizzaro=Wizzaro||{};Wizzaro.namespace=Wizzaro.namespace||function(a){var b,c,d=a.split("."),e=Wizzaro;for("Wizzaro"==d[0]&&(d=d.slice(1)),b=0,c=d.length;b<c;b++)"undefined"==jQuery.type(e[d[b]])&&(e[d[b]]={}),e=e[d[b]];return e},jQuery(document).ready(function(a){if("object"==typeof wpWizzaroGalleryUploaderInit){var b=navigator.userAgent.indexOf("Trident/")!=-1||navigator.userAgent.indexOf("MSIE ")!=-1;b||"flash"!==plupload.predictRuntime(wpWizzaroGalleryUploaderInit)||wpWizzaroGalleryUploaderInit.required_features&&wpWizzaroGalleryUploaderInit.required_features.hasOwnProperty("send_binary_string")||(wpWizzaroGalleryUploaderInit.required_features=wpWizzaroGalleryUploaderInit.required_features||{},wpWizzaroGalleryUploaderInit.required_features.send_binary_string=!0),Wizzaro.Plugins.Gallery.v1.UploaderObj=new Wizzaro.Plugins.Gallery.v1.Uploader({uploader_config:wpWizzaroGalleryUploaderInit,config:Wizzaro.Plugins.Gallery.v1.UploaderConfig,media_item_view_class:Wizzaro.Plugins.Gallery.v1.MediaItemView})}"object"==typeof wpWizzaroGalleryImagesInit&&(Wizzaro.Plugins.Gallery.v1.ImagesObj=new Wizzaro.Plugins.Gallery.v1.Images({ajax_data:wpWizzaroGalleryImagesInit,config:Wizzaro.Plugins.Gallery.v1.ImagesConfig,image_class:Wizzaro.Plugins.Gallery.v1.ImageItem,sortable_class:Wizzaro.Plugins.Gallery.v1.ImagesSortable}),"object"==typeof Wizzaro.Plugins.Gallery.v1.UploaderObj&&jQuery(Wizzaro.Plugins.Gallery.v1.UploaderObj).on("success_file_upload",function(a,b){Wizzaro.Plugins.Gallery.v1.ImagesObj.add_image(b.id,b.thumbnail_url)}))}),Wizzaro.namespace("Plugins.Gallery.v1"),Wizzaro.Plugins.Gallery.v1.ImageItem=function(a,b,c){function d(){l.addClass(m.loader_class)}function e(){l.removeClass(m.loader_class)}function f(a){return a.preventDefault(),a.stopPropagation(),d(),jQuery.ajax({url:ajaxurl,type:"post",data:{action:n.thumbnail.action,thumbnail_nonce:n.thumbnail.nonce,post_id:n.post_id,img_id:o},dataType:"json",success:function(a){"object"===jQuery.type(a)?"1"==a.status?g():j(a.message):j(n.thumbnail.l10n.error)},error:function(){j(n.thumbnail.l10n.error)}}),!1}function g(){l.addClass(m.thumbnail_class),e(),jQuery(k).trigger("set_as_thumbnail",l)}function h(a){return a.preventDefault(),a.stopPropagation(),window.confirm(_wpMediaViewsL10n.warnDelete)&&(d(),jQuery.ajax({url:ajaxurl,type:"post",data:{action:n.delete.action,delete_nonce:n.delete.nonce,post_id:n.post_id,img_id:o},dataType:"json",success:function(a){"object"===jQuery.type(a)?"1"==a.status?i():j(a.message):j(n.delete.l10n.error)},error:function(){j(n.delete.l10n.error)}})),!1}function i(){l.hide(m.visible_toogle_time),setTimeout(function(){l.remove(),jQuery(k).trigger("delete",k)},m.visible_toogle_time)}function j(a){alert(a),e()}var k=this,l=jQuery(a),m=b,n=c,o=l.find("."+m.image_id_elem_class).val();l.find("."+m.thumbnail.bt_class).on("click",f),l.find("."+m.delete.bt_class).on("click",h),this.get_img_id=function(){var a=l;return a}},Wizzaro.namespace("Plugins.Gallery.v1"),Wizzaro.Plugins.Gallery.v1.Images=function(a){function b(a,b){jQuery("#"+g.images.container_id).length<=0&&(jQuery("#"+g.container_id).html('<div id="'+g.images.container_id+'"></div>'),i.create());var d=jQuery(document.createElement("div")).addClass(g.image.container_class).addClass(g.image.invisible_class);d.html('<div class="wgi-image-wrapper"><div class="wgi-i-image"><img src="'+b+'" ></div><div class="wgi-i-butons"><a class="wgi-i-b-button '+g.image.thumbnail.bt_class+'" href="#" title="'+f.l10n.buttons_titles.set_thumbnail+'"><span class="dashicons dashicons-star-filled"></span></a><a class="wgi-i-b-button '+g.image.delete.bt_class+'" href="#" title="'+f.l10n.buttons_titles.delete+'"><span class="dashicons dashicons-trash"></span></a></div><input class="'+g.image.image_id_elem_class+'" type="hidden" name="wizzaro-gal-images[]" value="'+a+'"></div>'),d.hide(),jQuery("#"+g.images.container_id).append(d),c(d),d.show(g.image.visible_toogle_time)}function c(a){var b=new h(a,g.image,f);j[b.get_img_id]=b,jQuery(b).on("set_as_thumbnail",d),jQuery(b).on("delete",e)}function d(a,b){jQuery("#"+g.images.container_id+" ."+g.image.container_class).not(b).removeClass(g.image.thumbnail_class)}function e(a,b){delete j[b.get_img_id],jQuery("#"+g.images.container_id+" ."+g.image.container_class).length<=0&&(i.destroy(),jQuery("#"+g.container_id).html('<p id="'+g.images.no_image_container_id+'">'+f.l10n.no_image+"</p>"))}var f=a.ajax_data,g=a.config,h=a.image_class,i=new a.sortable_class(g.sortable),j={};jQuery("#"+g.images.container_id).length>0&&(jQuery("#"+g.images.container_id+" ."+g.image.container_class).each(function(){c(this)}),i.create()),this.add_image=b},Wizzaro.namespace("Plugins.Gallery.v1"),Wizzaro.Plugins.Gallery.v1.ImagesSortable=function(a){function b(){jQuery("#"+f.container_id).sortable({items:"> ."+f.items_class,placeholder:f.placeholder_class,cursor:"move",opacity:f.sort_opacity,update:function(a,b){}}).disableSelection()}function c(){jQuery("#"+f.container_id).sortable("destroy")}function d(){c(),b()}function e(){jQuery("#"+f.container_id).sortable("refresh")}var f=a;this.create=b,this.recreate=d,this.destroy=c,this.refresh=e},Wizzaro.namespace("Plugins.Gallery.v1"),Wizzaro.Plugins.Gallery.v1.ImagesConfig=Wizzaro.Plugins.Gallery.v1.ImagesConfig||{container_id:"wizzaro-gal-images",sortable:{container_id:"wgi-wrapper",items_class:"wgi-image-container",placeholder_class:"wgi-image-placeholder",sort_opacity:.7},images:{container_id:"wgi-wrapper",no_image_container_id:"wg-no-images"},image:{container_class:"wgi-image-container",image_id_elem_class:"wgi-i-image-id",loader_class:"loading",invisible_class:"invisible",thumbnail_class:"gallery-thumb",visible_toogle_time:200,thumbnail:{bt_class:"wgi-i-b-set-thumbnail"},preview:{bt_class:"wgi-i-b-preview"},edit:{bt_class:"wgi-i-b-edit"},delete:{bt_class:"wgi-i-b-del"}}},Wizzaro.namespace("Plugins.Gallery.v1"),Wizzaro.Plugins.Gallery.v1.MediaItemView=function(a){function b(a){return!!i.hasOwnProperty(a)}function c(a){if(b(a.id))return i[a.id];var c=jQuery(document.createElement("div"));return c.attr("id",h.media_items.item_id+a.id).addClass("media-item").append('<img class="pinkynail original" src="" alt="" />').append('<div class="progress"><div class="percent">0%</div><div class="bar"></div></div>',jQuery('<div class="filename original">').text(" "+a.name)).appendTo(jQuery("#"+h.media_items.container_id)),i[a.id]=c,c}function d(a,b){var d=c(a);if(d.data("last-err")!=a.id){var e="<p><strong>"+pluploadL10n.error_uploading.replace("%s",jQuery.trim(d.find(".filename").text()))+"</strong> "+b+"</p>";d.addClass("error").find(".filename").replaceWith(e),d.find(".progress").remove(),d.data("last-err",a.id)}}function e(a,b){var d=c(a);d.addClass("success"),d.find(".progress").remove(),d.find(".filename").addClass("new").removeClass("original").html(b.name),d.find(".pinkynail").addClass("new").removeClass("original").attr("src",b.thumbnail_url).show()}function f(a,c,d){b(a)&&i[a].find(".pinkynail."+d).attr("src",c).show()}function g(a,c,d){b(a)&&(i[a].find(".bar").width(c),i[a].find(".percent").html(d+"%"))}var h=a,i={};this.add_media_item=c,this.set_error=d,this.success_upload=e,this.set_thumbnail=f,this.set_upload_percent=g};var topWin=window.dialogArguments||opener||parent||top;Wizzaro.namespace("Plugins.Gallery.v1"),Wizzaro.Plugins.Gallery.v1.Uploader=function(a){function b(a){a.preventDefault(),a.stopPropagation(),jQuery(this).toggleClass("open");var b=jQuery("#"+n.layout.container_id);return b.is(":visible")?b.slideUp(n.layout.uploader_toogle_time):b.slideDown(n.layout.uploader_toogle_time),!1}function c(a){a.preventDefault(),a.stopPropagation();jQuery("#"+n.layout.container_id).toggleClass("html-uploader");"object"==jQuery.type(m)&&m.refresh()}function d(a,b){jQuery("#"+n.errors.container_id).empty();try{"undefined"!=typeof topWin.tb_remove&&topWin.jQuery("#TB_overlay").unbind("click",topWin.tb_remove)}catch(a){}plupload.each(b,function(a){k(a)}),a.refresh(),a.start()}function e(a,b){var c=104857600,d=parseInt(a.settings.max_file_size,10);d>c&&b.size>c&&setTimeout(function(){b.status<3&&0===b.loaded&&(o.set_error(b,pluploadL10n.big_upload_failed.replace("%1$s","").replace("%2$s","")),a.stop(),a.removeFile(b),a.start())},1e4)}function f(a,b){o.set_upload_percent(b.id,200*b.loaded/b.size,b.percent)}function g(a,b){var c,d=b.file,e=104857600;switch(b.code){case plupload.FAILED:o.set_error(d,pluploadL10n.upload_failed);break;case plupload.FILE_EXTENSION_ERROR:o.set_error(d,pluploadL10n.invalid_filetype);break;case plupload.FILE_SIZE_ERROR:o.set_error(d,pluploadL10n.file_exceeds_size_limit.replace("%s",d.name)),a.removeFile(d);break;case plupload.IMAGE_FORMAT_ERROR:o.set_error(d,pluploadL10n.not_an_image);break;case plupload.IMAGE_MEMORY_ERROR:o.set_error(d,pluploadL10n.image_memory_exceeded);break;case plupload.IMAGE_DIMENSIONS_ERROR:o.set_error(d,pluploadL10n.image_dimensions_exceeded);break;case plupload.GENERIC_ERROR:j(pluploadL10n.upload_failed);break;case plupload.IO_ERROR:c=parseInt(a.settings.filters.max_file_size,10),c>e&&d.size>e?o.set_error(d,pluploadL10n.big_upload_failed.replace("%1$s","").replace("%2$s","")):j(pluploadL10n.io_error);break;case plupload.HTTP_ERROR:j(pluploadL10n.http_error);break;case plupload.INIT_ERROR:jQuery("#"+n.layout.container_id).addClass("html-uploader");break;case plupload.SECURITY_ERROR:j(pluploadL10n.security_error);break;default:o.set_error(d,pluploadL10n.default_error)}a.refresh()}function h(a,b,c){var d;if(d=JSON.parse(c.response),d.status){try{"undefined"!=typeof topWin.tb_remove&&topWin.jQuery("#TB_overlay").click(topWin.tb_remove)}catch(a){}o.success_upload(b,d.data),jQuery(l).trigger("success_file_upload",d.data)}else o.set_error(b,d.data.error)}function i(){}function j(a){jQuery("#"+n.errors.container_id).show().html('<div class="error"><p>'+a+"</p></div>")}function k(a){var b=jQuery("#"+n.media_items.container_id).children();1==b.length&&b.removeClass("open").find(".slidetoggle").slideUp(200),o.add_media_item(a)}var l=this,m=new plupload.Uploader(a.uploader_config),n=a.config,o=new a.media_item_view_class(n);jQuery("#"+n.layout.open_uploader_bt_id).on("click",b),jQuery("#"+n.uploader.plupload_container_id+" "+n.uploader.switch_uploaders_bt_elem).on("click",c),jQuery("#"+n.uploader.html_container_id+" "+n.uploader.switch_uploaders_bt_elem).on("click",c),m.bind("Init",function(a){var b=jQuery("#"+n.uploader.plupload_container_id);a.features.dragdrop&&!jQuery(document.body).hasClass("mobile")?(b.addClass("drag-drop"),jQuery("#"+n.drag_drop_area.area_id).bind("dragover.wp-uploader",function(){b.addClass("drag-over")}).bind("dragleave.wp-uploader, drop.wp-uploader",function(){b.removeClass("drag-over")})):(b.removeClass("drag-drop"),jQuery("#"+n.drag_drop_area.area_id).unbind(".wp-uploader"))}),m.init(),m.bind("FilesAdded",d),m.bind("UploadFile",e),m.bind("UploadProgress",f),m.bind("Error",g),m.bind("FileUploaded",h),m.bind("UploadComplete",i)},Wizzaro.namespace("Plugins.Gallery.v1"),Wizzaro.Plugins.Gallery.v1.UploaderConfig=Wizzaro.Plugins.Gallery.v1.UploaderConfig||{layout:{container_id:"wizzaro-gal-uploader",open_uploader_bt_id:"wizzaro-gal-open-uploader",uploader_toogle_time:200},uploader:{plupload_container_id:"wizzaro-gal-plupload-upload-ui",html_container_id:"wizzaro-gal-html-upload-ui",switch_uploaders_bt_elem:".wizzaro-gal-bypass a"},drag_drop_area:{area_id:"wizzaro-gal-drag-drop-area"},errors:{container_id:"wizzaro-gal-media-upload-error"},media_items:{container_id:"wizzaro-gal-media-items",item_id:"wizzaro-gal-media-item-"}};